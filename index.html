<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘å€‘çš„æ‡·å­•æ—¥è¨˜ ğŸ‘¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-pink-50 min-h-screen pb-20 font-sans text-gray-800">

    <header class="bg-white p-6 rounded-b-3xl shadow-md text-center">
        <h1 class="text-xl font-bold">æˆ‘å€‘çš„æ‡·å­•ç­†è¨˜</h1>
        <p class="text-sm text-pink-500 mt-1 italic">åŒæ­¥é›²ç«¯è³‡æ–™åº«ä¸­...</p>
    </header>

    <script>
        // --- è«‹åœ¨é€™è£¡å¡«å…¥ä½ çš„ Supabase è³‡è¨Š ---
        const SUPABASE_URL = 'https://uashjbomzjaroxyjiion.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVhc2hqYm9temphcm94eWppaW9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NTIzODksImV4cCI6MjA4MzAyODM4OX0.PRcS3VpX3dkKS5qRf-SqBNCytVvVEdO1mEGdk6SYR2U';
        // ------------------------------------

        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // è®€å–è³‡æ–™çš„åŠŸèƒ½
        async function fetchExpenses() {
            const { data, error } = await supabase
                .from('expenses')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error('è®€å–å¤±æ•—:', error);
                return;
            }
            renderList(data);
        }

        // æ–°å¢è³‡æ–™çš„åŠŸèƒ½
        async function addExpense(category) {
            const amount = prompt(`è¼¸å…¥ã€Œ${category}ã€é‡‘é¡:`);
            if (!amount || isNaN(amount)) return;
            const note = prompt(`å‚™è¨» (é¸å¡«):`, category);

            const { error } = await supabase
                .from('expenses')
                .insert([{ amount: parseFloat(amount), category, note: note || category }]);

            if (error) {
                alert('å„²å­˜å¤±æ•—ï¼Œè«‹æª¢æŸ¥è³‡æ–™è¡¨æ¬Šé™');
                console.error(error);
            } else {
                fetchExpenses(); // é‡æ–°æ•´ç†æ¸…å–®
            }
        }

        // ç•«å‡ºæ¸…å–®åˆ°ç¶²é ä¸Š
        function renderList(list) {
            const listEl = document.getElementById('expense-list');
            const totalEl = document.getElementById('total-amount');
            let total = 0;
            listEl.innerHTML = '';

            list.forEach(item => {
                total += item.amount;
                const html = `
                    <div class="bg-white p-4 rounded-xl flex justify-between items-center shadow-sm">
                        <div class="flex items-center">
                            <div class="bg-pink-100 p-2 rounded-lg mr-3">${item.category === 'ç”¢æª¢' ? 'ğŸ¥' : 'ğŸ¼'}</div>
                            <div>
                                <p class="font-medium">${item.note}</p>
                                <p class="text-xs text-gray-400">${new Date(item.created_at).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <span class="font-bold text-rose-500">-$${item.amount}</span>
                    </div>`;
                listEl.insertAdjacentHTML('beforeend', html);
            });
            totalEl.innerText = `$ ${total.toLocaleString()}`;
        }

        // é é¢é–‹å•Ÿæ™‚è¼‰å…¥
        window.onload = fetchExpenses;
    </script>

    <main class="p-4">
        <div class="bg-gradient-to-r from-pink-400 to-rose-400 p-6 rounded-2xl text-white shadow-lg mb-6">
            <p class="text-sm opacity-90 text-center">ç´¯è¨ˆæº–å‚™åŸºé‡‘</p>
            <h2 id="total-amount" class="text-4xl font-bold text-center mt-2">$ 0</h2>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <button onclick="addExpense('ç”¢æª¢')" class="bg-white p-4 rounded-2xl shadow-sm text-center active:scale-95 transition">
                <i class="fas fa-stethoscope text-blue-400 text-2xl mb-2"></i>
                <p class="text-sm font-medium">ç”¢æª¢ç´€éŒ„</p>
            </button>
            <button onclick="addExpense('ç”¨å“')" class="bg-white p-4 rounded-2xl shadow-sm text-center active:scale-95 transition">
                <i class="fas fa-baby-carriage text-orange-400 text-2xl mb-2"></i>
                <p class="text-sm font-medium">è³¼è²·ç”¨å“</p>
            </button>
        </div>

        <section>
            <h3 class="font-bold text-gray-700 mb-4 px-2">æœ€è¿‘ç´€éŒ„</h3>
            <div id="expense-list" class="space-y-3">
                <p class="text-center text-gray-400">è®€å–ä¸­...</p>
            </div>
        </section>
    </main>

</body>
</html>
